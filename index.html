<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STILLFLARE // MAAS TERMINAL 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* MAIN DASHBOARD STYLING */
        body { background: #000; color: #fff; font-family: "Courier New", Courier, monospace; display: flex; justify-content: center; padding: 20px; margin: 0; }
        
        .terminal-card { 
            background: #000; width: 100%; max-width: 900px; padding: 40px; 
            border: 1px solid #333; box-shadow: 0 0 30px rgba(255,255,255,0.05);
        }

        .hr-header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        .hr-header img { width: 100%; max-width: 750px; height: auto; }

        .mission-brief { font-size: 12px; line-height: 1.6; border: 1px solid #333; padding: 20px; margin-bottom: 30px; background: #0a0a0a; color: #888; }
        .mission-brief b { color: #fff; letter-spacing: 1px; }

        .pulse-matrix { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        .pulse-matrix td { border: 1px solid #333; padding: 20px; text-align: center; }
        .label { font-size: 10px; color: #666; text-transform: uppercase; letter-spacing: 2px; }
        .value { font-size: 32px; font-weight: bold; color: #fff; }

        .chart-frame { border: 1px solid #333; height: 300px; padding: 15px; margin-bottom: 30px; background: #050505; }

        .slider-group { border-top: 1px dashed #333; padding-top: 25px; }
        .slider-row { display: flex; align-items: center; margin-bottom: 20px; }
        .slider-label { flex: 2; font-size: 12px; font-weight: bold; color: #aaa; }
        .slider-input { flex: 3; accent-color: #fff; cursor: pointer; }
        .slider-val { flex: 1; text-align: right; font-weight: bold; font-size: 18px; color: #fff; }

        .ops-panel { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 40px; }
        button { 
            background: #000; color: #fff; border: 2px solid #fff; padding: 18px; 
            font-family: "Courier New"; font-weight: bold; cursor: pointer; 
            text-transform: uppercase; transition: 0.2s;
        }
        button:hover { background: #fff; color: #000; }

        #status { font-size: 10px; color: #333; text-align: center; margin-top: 20px; letter-spacing: 5px; }
    </style>
</head>
<body>

<div class="terminal-card">
    <div class="hr-header">
        <img src="https://raw.githubusercontent.com/stillflareentertainment-web/stillflare-lab/main/STILLFLARE%20BANNER.png" alt="STILLFLARE BANNER">
    </div>

    <div class="mission-brief">
        <b>[ OPERATIONAL PROTOCOL 2026 ]</b><br>
        The <b>MAAS Intelligence Suite</b> serves as a decentralized telemetry node. By committing your local data, you contribute to the <b>Global Community Pulse</b>. This data drives collective stability and helps determine the trajectory of Stillflare development.
    </div>

    <table class="pulse-matrix">
        <tr>
            <td><span class="label">Global_Pulse</span><div id="globalPulse" class="value">--%</div></td>
            <td><span class="label">Local_Identity</span><div id="personalPulse" class="value">--%</div></td>
            <td><span class="label">Trend_Vector</span><div id="trendVal" class="value">--</div></td>
        </tr>
    </table>

    <div class="chart-frame"><canvas id="mainChart"></canvas></div>

    <div class="slider-group">
        <div class="slider-row"><div class="slider-label">QS_SERVICE</div><input type="range" id="qs" class="slider-input" min="0" max="100" value="50" oninput="u('qs')"><div id="qsVal" class="slider-val">50%</div></div>
        <div class="slider-row"><div class="slider-label">OI_INTEL</div><input type="range" id="oi" class="slider-input" min="0" max="100" value="50" oninput="u('oi')"><div id="oiVal" class="slider-val">50%</div></div>
        <div class="slider-row"><div class="slider-label">IC_CAPACITY</div><input type="range" id="ic" class="slider-input" min="0" max="100" value="50" oninput="u('ic')"><div id="icVal" class="slider-val">50%</div></div>
        <div class="slider-row"><div class="slider-label">EP_ENGINE</div><input type="range" id="ep" class="slider-input" min="0" max="100" value="50" oninput="u('ep')"><div id="epVal" class="slider-val">50%</div></div>
    </div>

    <div class="ops-panel">
        <button onclick="transmitData()">[ COMMIT_SYNC ]</button>
        <button onclick="generateTextReport()">[ ARCHIVE_REPORT ]</button>
    </div>

    <div id="status">NODE_STABLE // 2026_STILLFLARE_OS</div>
</div>

<script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRRO9rzX0DOaCBEppRFcRXtsIxxgK6fT6KIxAjFhq44PaoBEAtEy8fwjTEFNc9QZofF2P9srq0eYT4c/pub?gid=718698897&single=true&output=csv";
    let mainChart;

    function u(id) { document.getElementById(id + 'Val').innerText = document.getElementById(id).value + '%'; }

    function initChart() {
        const ctx = document.getElementById('mainChart').getContext('2d');
        mainChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [], 
                datasets: [
                    { label: 'GLOBAL', borderColor: '#333', data: [], tension: 0, borderWidth: 1, pointRadius: 0 },
                    { label: 'LOCAL', borderColor: '#fff', data: [], tension: 0, borderWidth: 2, pointRadius: 0 }
                ]
            },
            options: { 
                responsive: true, maintainAspectRatio: false, 
                plugins: { legend: { labels: { color: '#fff', font: { family: 'Courier New' } } } },
                scales: { 
                    y: { beginAtZero: true, max: 100, grid: { color: '#111' }, ticks: { color: '#444' } },
                    x: { grid: { color: '#111' }, ticks: { color: '#444' } }
                }
            }
        });
    }

    async function syncData() {
        try {
            const response = await fetch(CSV_URL + "&cb=" + Date.now());
            const data = await response.text();
            const rows = data.split('\n').filter(r => r.trim() !== "").slice(1);
            let commData = []; let total = 0;
            rows.forEach(r => {
                const c = r.split(',');
                if(c.length >= 5) {
                    const avg = (parseInt(c[1]) + parseInt(c[2]) + parseInt(c[3]) + parseInt(c[4])) / 4;
                    commData.push(avg); total += avg;
                }
            });
            document.getElementById('globalPulse').innerText = (rows.length > 0 ? Math.round(total / rows.length) : 0) + "%";
            const pData = JSON.parse(localStorage.getItem('stillflare_history') || "[]");
            if (pData.length > 0) {
                document.getElementById('personalPulse').innerText = pData[pData.length - 1] + "%";
                if(pData.length >= 2) {
                    const diff = pData[pData.length - 1] - pData[pData.length - 2];
                    document.getElementById('trendVal').innerText = diff >= 0 ? "ASCENDING" : "DESCENDING";
                }
            }
            mainChart.data.labels = Array.from({length: Math.max(rows.length, pData.length)}, (_, i) => i + 1);
            mainChart.data.datasets[0].data = commData;
            mainChart.data.datasets[1].data = pData;
            mainChart.update();
        } catch (e) { console.error(e); }
    }

    async function transmitData() {
        const v = [document.getElementById('qs').value, document.getElementById('oi').value, document.getElementById('ic').value, document.getElementById('ep').value];
        const avg = Math.round(v.reduce((a,b) => parseInt(a)+parseInt(b)) / 4);
        let h = JSON.parse(localStorage.getItem('stillflare_history') || "[]");
        h.push(avg); localStorage.setItem('stillflare_history', JSON.stringify(h));
        const fID = "1FAIpQLSeqartuUmgNYc5RWaREX2yX0aGJU8_hWgAw8GKZiLK2QoXFpQ";
        const url = `https://docs.google.com/forms/d/e/${fID}/formResponse?entry.931849910=${v[0]}&entry.1206314523=${v[1]}&entry.1670010429=${v[2]}&entry.152757542=${v[3]}&submit=Submit`;
        document.getElementById('status').innerText = "PUSHING TELEMETRY...";
        fetch(url, { mode: 'no-cors' }).then(() => {
            document.getElementById('status').innerText = "SYNC COMPLETE.";
            syncData();
        });
    }

    function generateTextReport() {
        const gPulse = document.getElementById('globalPulse').innerText;
        const lPulse = document.getElementById('personalPulse').innerText;
        const trend = document.getElementById('trendVal').innerText;
        const history = JSON.parse(localStorage.getItem('stillflare_history') || "[]");
        const ts = new Date().toLocaleString();

        const reportWindow = window.open('', '_blank');
        reportWindow.document.write(`
            <html>
            <head>
                <title>STILLFLARE_HR_ARCHIVE_2026</title>
                <style>
                    body { background: #000; color: #fff; font-family: "Courier New", monospace; padding: 40px; line-height: 1.4; }
                    .banner { text-align: center; border-bottom: 2px solid #fff; padding-bottom: 20px; margin-bottom: 30px; }
                    .banner img { width: 100%; max-width: 650px; }
                    .meta { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 40px; color: #888; }
                    .section { margin-bottom: 30px; border-left: 2px solid #fff; padding-left: 20px; }
                    .data-row { display: flex; justify-content: space-between; max-width: 500px; margin-bottom: 8px; border-bottom: 1px dotted #333; }
                    .log-table { width: 100%; max-width: 500px; border-collapse: collapse; margin-top: 15px; }
                    .log-table td { border: 1px solid #333; padding: 8px; text-align: center; }
                    button { background: #fff; color: #000; padding: 15px; font-weight: bold; border: none; cursor: pointer; margin-top: 40px; width: 100%; max-width: 500px; }
                    @media print { button { display: none; } }
                </style>
            </head>
            <body>
                <div class="banner">
                    <img src="https://raw.githubusercontent.com/stillflareentertainment-web/stillflare-lab/main/STILLFLARE%20BANNER.png">
                    <h2>OFFICIAL INTELLIGENCE ARCHIVE</h2>
                    <p>MAAS HR PROTOCOL // v3.1</p>
                </div>

                <div class="meta">
                    <span>NODE_ID: ${Math.random().toString(36).substr(2, 9).toUpperCase()}</span>
                    <span>TIMESTAMP: ${ts}</span>
                </div>

                <div class="section">
                    <h3>[ MISSION PROTOCOL ]</h3>
                    <p>This document serves as a verified archive of local operative telemetry. By logging performance against the Global Community Pulse, Stillflare Labs ensures decentralized data integrity and communal growth trajectory.</p>
                </div>

                <div class="section">
                    <h3>[ PERFORMANCE DATA ]</h3>
                    <div class="data-row"><span>GLOBAL_PULSE:</span><span>${gPulse}</span></div>
                    <div class="data-row"><span>LOCAL_PULSE:</span><span>${lPulse}</span></div>
                    <div class="data-row"><span>TREND_VECTOR:</span><span>${trend}</span></div>
                </div>

                <div class="section">
                    <h3>[ HISTORICAL LOG ]</h3>
                    <table class="log-table">
                        <tr><td>ENTRY_ID</td><td>RESULT_SCORE</td></tr>
                        ${history.map((val, i) => `<tr><td>LOG_00${i+1}</td><td>${val}%</td></tr>`).join('')}
                    </table>
                </div>

                <button onclick="window.print()">[ DOWNLOAD PHYSICAL ARCHIVE ]</button>
                <p style="font-size: 10px; color: #333; margin-top: 50px;">CONFIDENTIAL // STILLFLARE LABS 2026</p>
            </body>
            </html>
        `);
        reportWindow.document.close();
    }

    window.onload = () => { initChart(); syncData(); };
</script>

</body>
</html>
