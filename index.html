<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STILLFLARE // HR ARCHIVE v2.9</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: #ced4da; color: #000; font-family: "Courier New", Courier, monospace; display: flex; justify-content: center; padding: 20px; margin: 0; }
        .terminal-card { background: #fff; width: 100%; max-width: 800px; padding: 40px; border: 2px solid #000; box-shadow: 10px 10px 0px #000; position: relative; }
        .hr-header { border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; text-align: center; }
        .hr-header img { width: 100%; max-height: 100px; object-fit: contain; }
        .intro-box { font-size: 12px; margin-bottom: 20px; line-height: 1.4; border: 1px solid #000; padding: 15px; background: #f8f9fa; }
        
        .pulse-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .pulse-table td { border: 1px solid #000; padding: 10px; text-align: center; }
        .label { font-size: 10px; font-weight: bold; text-decoration: underline; display: block; }
        .value { font-size: 24px; font-weight: bold; }

        .chart-frame { border: 1px solid #000; height: 250px; padding: 10px; margin-bottom: 20px; }

        .form-section { border-top: 1px dashed #000; padding-top: 20px; }
        .slider-row { display: flex; align-items: center; margin-bottom: 15px; }
        .slider-label { flex: 2; font-size: 13px; font-weight: bold; }
        .slider-input { flex: 3; accent-color: #000; }
        .slider-val { flex: 1; text-align: right; font-weight: bold; }

        .ops-group { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        button { background: #fff; border: 2px solid #000; padding: 15px; font-family: "Courier New"; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        button:hover { background: #000; color: #fff; }
        #status { font-size: 11px; margin-top: 20px; border-top: 1px solid #000; padding-top: 10px; text-align: center; }
    </style>
</head>
<body>

<div class="terminal-card">
    <div class="hr-header">
        <img src="https://raw.githubusercontent.com/stillflareentertainment-web/stillflare-lab/main/STILLFLARE%20BANNER.png" alt="STILLFLARE BANNER">
    </div>

    <div class="intro-box">
        [ SYSTEM ]: STILLFLARE MAAS // INTELLIGENCE TERMINAL v2.9<br>
        [ MISSION ]: COLLECT LOCAL TELEMETRY // SYNC GLOBAL PULSE.<br>
        [ METHOD ]: ADJUST VECTORS -> COMMIT -> PRINT TEXT ARCHIVE.<br>
        [ DIRECTION ]: COMMUNITY EVOLUTION VIA DATA TRANSPARENCY.
    </div>

    <table class="pulse-table">
        <tr>
            <td><span class="label">GLOBAL_PULSE</span><div id="globalPulse" class="value">--%</div></td>
            <td><span class="label">LOCAL_PULSE</span><div id="personalPulse" class="value">--%</div></td>
            <td><span class="label">VECTOR_TREND</span><div id="trendVal" class="value">--</div></td>
        </tr>
    </table>

    <div class="chart-frame"><canvas id="mainChart"></canvas></div>

    <div class="form-section">
        <div class="slider-row"><div class="slider-label">QS_SERVICE</div><input type="range" id="qs" class="slider-input" min="0" max="100" value="50" oninput="u('qs')"><div id="qsVal" class="slider-val">50%</div></div>
        <div class="slider-row"><div class="slider-label">OI_INTEL</div><input type="range" id="oi" class="slider-input" min="0" max="100" value="50" oninput="u('oi')"><div id="oiVal" class="slider-val">50%</div></div>
        <div class="slider-row"><div class="slider-label">IC_CAPACITY</div><input type="range" id="ic" class="slider-input" min="0" max="100" value="50" oninput="u('ic')"><div id="icVal" class="slider-val">50%</div></div>
        <div class="slider-row"><div class="slider-label">EP_ENGINE</div><input type="range" id="ep" class="slider-input" min="0" max="100" value="50" oninput="u('ep')"><div id="epVal" class="slider-val">50%</div></div>
    </div>

    <div class="ops-group">
        <button onclick="transmitData()">[ COMMIT_DATA ]</button>
        <button onclick="generateTextReport()">[ PRINT_REPORT ]</button>
    </div>

    <div id="status">TERMINAL_OK // READY_FOR_INGESTION</div>
</div>

<script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRRO9rzX0DOaCBEppRFcRXtsIxxgK6fT6KIxAjFhq44PaoBEAtEy8fwjTEFNc9QZofF2P9srq0eYT4c/pub?gid=718698897&single=true&output=csv";
    let mainChart;

    function u(id) { document.getElementById(id + 'Val').innerText = document.getElementById(id).value + '%'; }

    function initChart() {
        const ctx = document.getElementById('mainChart').getContext('2d');
        mainChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [], 
                datasets: [
                    { label: 'GLOBAL', borderColor: '#000', data: [], tension: 0, borderWidth: 2, pointRadius: 0 },
                    { label: 'LOCAL', borderColor: '#000', borderDash: [5, 5], data: [], tension: 0, borderWidth: 2, pointRadius: 0 }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, animation: false, scales: { y: { beginAtZero: true, max: 100 } } }
        });
    }

    async function syncData() {
        try {
            const response = await fetch(CSV_URL + "&cb=" + Date.now());
            const data = await response.text();
            const rows = data.split('\n').filter(r => r.trim() !== "").slice(1);
            let commData = []; let total = 0;
            rows.forEach(r => {
                const c = r.split(',');
                if(c.length >= 5) {
                    const avg = (parseInt(c[1]) + parseInt(c[2]) + parseInt(c[3]) + parseInt(c[4])) / 4;
                    commData.push(avg); total += avg;
                }
            });
            document.getElementById('globalPulse').innerText = (rows.length > 0 ? Math.round(total / rows.length) : 0) + "%";
            const pData = JSON.parse(localStorage.getItem('stillflare_history') || "[]");
            if (pData.length > 0) {
                document.getElementById('personalPulse').innerText = pData[pData.length - 1] + "%";
                if(pData.length >= 2) {
                    const diff = pData[pData.length - 1] - pData[pData.length - 2];
                    document.getElementById('trendVal').innerText = diff >= 0 ? "ASCEND" : "DESCEND";
                }
            }
            mainChart.data.labels = Array.from({length: Math.max(rows.length, pData.length)}, (_, i) => i + 1);
            mainChart.data.datasets[0].data = commData;
            mainChart.data.datasets[1].data = pData;
            mainChart.update();
        } catch (e) { console.error(e); }
    }

    async function transmitData() {
        const v = [document.getElementById('qs').value, document.getElementById('oi').value, document.getElementById('ic').value, document.getElementById('ep').value];
        const avg = Math.round(v.reduce((a,b) => parseInt(a)+parseInt(b)) / 4);
        let h = JSON.parse(localStorage.getItem('stillflare_history') || "[]");
        h.push(avg); localStorage.setItem('stillflare_history', JSON.stringify(h));
        const fID = "1FAIpQLSeqartuUmgNYc5RWaREX2yX0aGJU8_hWgAw8GKZiLK2QoXFpQ";
        const url = `https://docs.google.com/forms/d/e/${fID}/formResponse?entry.931849910=${v[0]}&entry.1206314523=${v[1]}&entry.1670010429=${v[2]}&entry.152757542=${v[3]}&submit=Submit`;
        document.getElementById('status').innerText = "COMMITTING TELEMETRY...";
        fetch(url, { mode: 'no-cors' }).then(() => {
            document.getElementById('status').innerText = "SYNC COMPLETE.";
            syncData();
        });
    }

    function generateTextReport() {
        const gPulse = document.getElementById('globalPulse').innerText;
        const lPulse = document.getElementById('personalPulse').innerText;
        const trend = document.getElementById('trendVal').innerText;
        const history = JSON.parse(localStorage.getItem('stillflare_history') || "[]");
        const ts = new Date().toLocaleString();

        const reportWindow = window.open('', '_blank');
        reportWindow.document.write(`
            <html>
            <head>
                <title>MAAS_HR_ARCHIVE_${Date.now()}</title>
                <style>
                    body { font-family: "Courier New", monospace; padding: 50px; line-height: 1.2; color: #000; }
                    .header { border-bottom: 3px double #000; padding-bottom: 10px; margin-bottom: 20px; }
                    .row { display: flex; justify-content: space-between; max-width: 500px; margin-bottom: 5px; }
                    .history-table { border: 1px solid #000; margin-top: 20px; width: 100%; max-width: 500px; }
                    .history-table td { border: 1px solid #000; padding: 5px; text-align: center; }
                    @media print { button { display: none; } }
                </style>
            </head>
            <body>
                <div class="header">
                    <h1>STILLFLARE LABS // HR ARCHIVE</h1>
                    <p>SERIAL_ID: ${Math.random().toString(36).substr(2, 9).toUpperCase()}</p>
                    <p>TIMESTAMP: ${ts}</p>
                </div>
                
                <h3>[ OPERATIONAL SUMMARY ]</h3>
                <div class="row"><span>GLOBAL_COMMUNITY_PULSE:</span><span>${gPulse}</span></div>
                <div class="row"><span>LOCAL_OPERATIVE_PULSE:</span><span>${lPulse}</span></div>
                <div class="row"><span>DIRECTIONAL_TREND:</span><span>${trend}</span></div>
                
                <br>
                <h3>[ IDENTITY HISTORY LOG ]</h3>
                <table class="history-table">
                    <tr><td>ENTRY</td><td>SCORE</td></tr>
                    ${history.map((val, i) => `<tr><td>#${i+1}</td><td>${val}%</td></tr>`).join('')}
                </table>

                <br><br>
                <p>--------------------------------------------------</p>
                <p>END OF REPORT // DATA IS CONFIDENTIAL</p>
                <br>
                <button onclick="window.print()">[ PRINT TO PHYSICAL / PDF ]</button>
            </body>
            </html>
        `);
        reportWindow.document.close();
    }

    window.onload = () => { initChart(); syncData(); };
</script>

</body>
</html>
